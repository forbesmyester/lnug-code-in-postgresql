---
layout: post
title: Investigating HashiCorp Terraform
tag: 
---

<p>I am a big fan of proper provisioning tools, such as <a href="https://www.ansible.com/">Ansible</a> to get repeatable processes for setting up servers. I am also used to using things like <a href="https://www.docker.com/">Docker</a> to control installation of the actual project onto the machine. This always leaves the question of how to get the machine to run these excellent tools on and this problem has bothered me for quite a while.</p><p>One potential solutions is to use something like AWS OpsWorks (which is powered by Chef) or something like AWS ElasticBeanstalk that is something more like Heroku but I don't much like Chef and the Heroku like solutions leave me wanting more control.</p><p>This weekend I decided that I would investigate <a href="https://www.hashicorp.com/">HashiCorp's</a> <a href="https://www.terraform.io/">Terraform</a> which is billed as a way to get infrastructure as code. These are the steps I took:</p><p>Downloaded Terraform from <a href="https://releases.hashicorp.com/terraform/0.6.14/terraform_0.6.14_linux_amd64.zip">here</a>.</p><p>Extracted and install Terraform.</p><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">mkdir</span> terraform-bin<br /><span class="kw">cd</span> terraform-bin<br /><span class="kw">unzip</span> /tmp/terraform_0.6.14_linux_amd64.zip<br /><span class="kw">cd</span> ../<br /><span class="kw">export</span> <span class="ot">PATH=$PATH</span>:terraform-bin</code></pre><p>I then followed through all the tutorials from the <a href="https://www.terraform.io/intro/getting-started/install.html">Terraform Getting Started Tutorial</a> except Modules.</p><p>During this process I wanted to use the JSON format and was for a while but then I wanted to comment the configuration file, the JSON format does not have a comment syntax so I switched over to the <code>.tf</code> format. I was concerned about the syntax highlighting etc within my editor but installing the <a href="https://github.com/hashivim/vim-terraform">VIM hashivim/vim-terraform plugin</a> fixed that right up.</p><p>Later on I went and looked at the modules. I didn't follow this part of the Getting Started guide as it included a link to a module which was broken and I was keen to understand how modules worked thus wanted to see code before using a module. Looking at samples and the documentation I managed to peice together a Tagged Instance with a Key Pair running in a VPC subnet... I think this is quite an achievement after having spent only a few hours with these tools!</p><p>There are, at the most basic level three things in Terraform you'll want to do to get a basic understanding... these are:</p><ul><li><p>Write configuration files, these are what you'll find in <a href="https://github.com/forbesmyester/hashicorp-terraform-getting-started">this repository</a>.</p></li><li><p>Check what those configuration files will do. This is is easy:</p></li></ul><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">terraform</span> plan -var <span class="st">&quot;aws_access_key_id=</span><span class="ot">$AWS_ACCESS_KEY_ID</span><span class="st">&quot;</span> -var <span class="st">&quot;aws_secret_access_key=</span><span class="ot">$AWS_SECRET_ACCESS_KEY</span><span class="st">&quot;</span></code></pre><ul><li>Use those configuration files to launch infrastructure</li></ul><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">terraform</span> apply -var <span class="st">&quot;aws_access_key_id=</span><span class="ot">$AWS_ACCESS_KEY_ID</span><span class="st">&quot;</span> -var <span class="st">&quot;aws_secret_access_key=</span><span class="ot">$AWS_SECRET_ACCESS_KEY</span><span class="st">&quot;</span></code></pre><p>Later on you'll probably want to destroy your infrastructure so you no longer get charged:</p><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">terraform</span> apply -var <span class="st">&quot;aws_access_key_id=</span><span class="ot">$AWS_ACCESS_KEY_ID</span><span class="st">&quot;</span> -var <span class="st">&quot;aws_secret_access_key=</span><span class="ot">$AWS_SECRET_ACCESS_KEY</span><span class="st">&quot;</span></code></pre><p>Think I'll need to look at <a href="https://www.terraform.io/docs/commands/taint.html">tainting</a> before I put anything into production with these tools and I am slightly concerned about the state being local files, but there are <a href="https://www.terraform.io/docs/commands/remote.html">partial</a>, and <a href="https://www.hashicorp.com/atlas.html">paid for</a> solutions to that. but given how excellent these tools appear to be I can live with these limitations!</p><p>One more awesome thing I found out is that Terraform can output Graphviz Graphs <a href="http://keyboardwritescode.blogspot.co.uk/2015/07/weekend-project-db-diayaml.html">which I absolutely love</a>. Running:</p><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">terraform</span> graph</code></pre><p>outputs the following to STDOUT</p><pre class="dot"><code>digraph {<br />    compound = &quot;true&quot;<br />    newrank = &quot;true&quot;<br />    subgraph &quot;root&quot; {<br />        &quot;[root] aws_eip.ip&quot; [label = &quot;aws_eip.ip&quot;, shape = &quot;box&quot;]<br />        &quot;[root] aws_instance.example&quot; [label = &quot;aws_instance.example&quot;, shape = &quot;box&quot;]<br />        &quot;[root] module.with-net.aws_instance.the-vpc-subnet-instance&quot; [label = &quot;aws_instance.the-vpc-subnet-instance&quot;, shape = &quot;box&quot;]<br />        &quot;[root] module.with-net.aws_key_pair.debug&quot; [label = &quot;aws_key_pair.debug&quot;, shape = &quot;box&quot;]<br />        &quot;[root] module.with-net.aws_subnet.the-vpc-subnet&quot; [label = &quot;aws_subnet.the-vpc-subnet&quot;, shape = &quot;box&quot;]<br />        &quot;[root] module.with-net.aws_vpc.the-vpc&quot; [label = &quot;aws_vpc.the-vpc&quot;, shape = &quot;box&quot;]<br />        &quot;[root] module.with-net.provider.aws&quot; [label = &quot;provider.aws&quot;, shape = &quot;diamond&quot;]<br />        &quot;[root] provider.aws&quot; [label = &quot;provider.aws&quot;, shape = &quot;diamond&quot;]<br />        &quot;[root] aws_eip.ip&quot; -&gt; &quot;[root] aws_instance.example&quot;<br />        &quot;[root] aws_eip.ip&quot; -&gt; &quot;[root] provider.aws&quot;<br />        &quot;[root] aws_instance.example&quot; -&gt; &quot;[root] provider.aws&quot;<br />        &quot;[root] module.with-net.aws_instance.the-vpc-subnet-instance&quot; -&gt; &quot;[root] module.with-net.aws_subnet.the-vpc-subnet&quot;<br />        &quot;[root] module.with-net.aws_instance.the-vpc-subnet-instance&quot; -&gt; &quot;[root] module.with-net.provider.aws&quot;<br />        &quot;[root] module.with-net.aws_key_pair.debug&quot; -&gt; &quot;[root] module.with-net.provider.aws&quot;<br />        &quot;[root] module.with-net.aws_subnet.the-vpc-subnet&quot; -&gt; &quot;[root] module.with-net.aws_vpc.the-vpc&quot;<br />        &quot;[root] module.with-net.aws_subnet.the-vpc-subnet&quot; -&gt; &quot;[root] module.with-net.provider.aws&quot;<br />        &quot;[root] module.with-net.aws_vpc.the-vpc&quot; -&gt; &quot;[root] module.with-net.provider.aws&quot;<br />        &quot;[root] module.with-net.provider.aws&quot; -&gt; &quot;[root] provider.aws&quot;<br />    }<br />}</code></pre><p>Which when rendered using either the command line tools or <a href="http://mdaines.github.io/viz.js/">this cross compilation project</a> gives you the following output:</p> <div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-vNiE6ocV_AY/VxNefIQSq1I/AAAAAAAARxs/d85jK7XGiZ4pEBpdINSJ0QdBuCqrH6oOgCLcB/s1600/graph.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://3.bp.blogspot.com/-vNiE6ocV_AY/VxNefIQSq1I/AAAAAAAARxs/d85jK7XGiZ4pEBpdINSJ0QdBuCqrH6oOgCLcB/s400/graph.png" /></a></div> <style>pre {     margin: 1em;     background-color: #DDD;     padding: 0.5em;     border: 1px #AAA solid; }  pre code {     padding: 0 0; }  code {     background-color: #DDD;     padding: 0 0.3em; } </style>
