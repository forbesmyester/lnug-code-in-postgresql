---
layout: post
title: 'Weekend Project: DB DiaYAML'
tag: 
---

<h2 id="why">Why</h2><p>When thinking about problems I sometimes come up with ideas on how to solve them. It might be a great solution, but more often than not they need some finesse and I may want to discuss them with other developers.</p><p>I find diagrams are a highly effective way of either organising my own thoughts or explaining them to other people. The diagrams themselves often don't need to be pretty or polished, they just need to be enough to support the idea, which might ultimately prove to be pretty rubbish. If I need to do the diagram again once the ideas have been proven, fine, but right now I need to draw something <strong>fast</strong>.</p><p>For this reason I am a fan of <a href="http://asciiflow.com/">Asciiflow</a> which I wrote about <a href="http://keyboardwritescode.blogspot.com/2013/04/asciiflow.html">here</a> and I have also found <a href="http://keyboardwritescode.blogspot.com/2013/06/graphviz.html">GraphViz / DOT to be an excellent tool</a>. With GraphViz / DOT I have also gone much further, in <a href="https://github.com/forbesmyester/SyncIt">SyncIt</a> if you're running the tests in the brower you can uncomment one line and the tests will output diagrams of internal data structures to support debugging, this was a huge time saver when it came to debugging.</p><p>I have also used GraphViz / DOT to draw database diagrams however the format itself is not particularly well suited to the job requiring some duplication and the syntax for basic vertical tables is a little bit tricky. Even so when I'm only looking at low numbers of tables I'd probably still prefer to do GraphViz / DOT than fire up some graphical tool which I won't even have installed.</p><h2 id="the-creation-unix-style">The Creation (UNIX Style)</h2><p>Being frustrated and having my itch to scratch I spent a few journeys to / from work and half a day over the weekend creating <a href="https://github.com/forbesmyester/db-diayaml">DB DiaYAML</a> which takes simple YAML (or JSON) files like this:</p><pre><code>person: # A Table<br />    name: # A Field<br />address:<br />    line1:<br />    line2:<br />    person: # Link adds a foreign key (missing field implies `id`, will be added if not already existing!)<br />    link: person<br />order:<br />    address: address # Shorter version of a foreign key<br />a:<br />    letter:<br />        link: person.name # A foreign key to a specific field<br />b:<br />    id:<br />    something:</code></pre><p>and converts them into a basic GraphViz / DOT format which looks like this:</p><pre><code>digraph db {<br />  subgraph clusterperson {<br />    label = &quot;person&quot;;<br />    structperson [label=&quot;{&lt;person__id&gt;id|&lt;person__name&gt;name}&quot;,shape=record];<br />  }<br />  subgraph clusteraddress {<br />    label = &quot;address&quot;;<br />    structaddress [label=&quot;{&lt;address__id&gt;id|&lt;address__line1&gt;line1|&lt;address__line2&gt;line2|&lt;address__link&gt;link|&lt;address__person&gt;person}&quot;,shape=record];<br />  }<br />  subgraph clusterorder {<br />    label = &quot;order&quot;;<br />    structorder [label=&quot;{&lt;order__address&gt;address}&quot;,shape=record];<br />  }<br />  subgraph clustera {<br />    label = &quot;a&quot;;<br />    structa [label=&quot;{&lt;a__letter&gt;letter}&quot;,shape=record];<br />  }<br />  subgraph clusterb {<br />    label = &quot;b&quot;;<br />    structb [label=&quot;{&lt;b__id&gt;id|&lt;b__something&gt;something}&quot;,shape=record];<br />  }<br />  structaddress:address__link -&gt; structperson:person__id<br />  structorder:order__address -&gt; structaddress:address__id<br />  structa:a__letter -&gt; structperson:person__name<br />}</code></pre><p>Which when ran through the command line tool creates a diagram that looks like:</p><div class="figure"><img src="https://raw.githubusercontent.com/forbesmyester/db-diayaml/master/bin/dbdiagram.png" alt="A GraphViz DB diagram, created by DB DiaYAML" /><p class="caption">A GraphViz DB diagram, created by DB DiaYAML</p></div><h2 id="the-live-editing-and-preview-web-service">The Live Editing and Preview Web Service</h2><p>In addition to this, if you don't want to install anything, you can use the <a href="http://forbesmyester.github.io/db-diayaml/">GitHub hosted mini service</a>.</p><h2 id="its-all-on-github">It's all on GitHub</h2><p>For the source, go to <a href="https://github.com/forbesmyester/db-diayaml">my GitHub account</a>.</p><h2 id="update-1">Update 1:</h2><p>We can now add DOT styles to lines like the following:</p><pre><code>order:<br />  customer:<br />    link:<br />      target: person.id # A foreign key to a specific field<br />      diaprops: # Any GraphViz/Dot property allowed in here<br />        color: red</code></pre><p>So the following diagrams can now be possible:</p><div class="figure"><img src="https://raw.githubusercontent.com/forbesmyester/db-diayaml/master/bin/dbdiagram2.png" alt="An enhanced GraphViz DB diagram, created by DB DiaYAML" /><p class="caption">An enhanced GraphViz DB diagram, created by DB DiaYAML</p></div><p>Of course the simpler forms are still supported:</p><pre><code>order:<br />  customer:<br />    link: person.id</code></pre><p>And:</p><pre><code>order:<br />  customer: person.id</code></pre><p>And:</p><pre><code>order:<br />  customer: person</code></pre><p>So you can be as detailed or brief as you wish!</p><style>     pre {         margin: 1em;         background-color: #DDD;         padding: 0.5em;         border: 1px #AAA solid;     }          pre code {       padding: 0 0;     }          code {       background-color: #DDD;       padding: 0 0.3em;     }  </style>
