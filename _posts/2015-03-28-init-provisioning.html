---
layout: post
title: Init Provisioning
tag: 
---

<p>I have a desire set up virtual machines on my laptop using scripts for testing things like microservices. Unfortunately I don't much like BASH as a provisioning system and would prefer to work with <a href="http://www.ansible.com/home">Ansible</a>.</p><p>The Init Provisioning scripts are designed to allow easy development of Ansible based virtual machines they perform the following tasks.</p><ul><li>Copy your SSH config and keys from <code>~/.ssh/</code> into the virtual machine for authentication with GitHub etc.</li><li>Install libraries necessary to install Ansible using <a href="http://en.wikipedia.org/wiki/Pip_%28package_manager%29">pip</a></li><li>Install Ansible.</li><li>Set up the <code>/etc/ansible/hosts</code> file with roles coming from an environmental variable.</li><li>Run <code>ansible-pull</code> on repositories and playbooks which are also configured from environmental variables.</li></ul><p>The following environmental variables are used:</p><blockquote><p><code>ROLES</code>: This is a semi colon separated list of all the roles you wish to give the virtual machine. These will be stored in <code>/etc/ansible/hosts</code></p><p><code>ANSIBLE_PULL_REPOSITORY_PLAYBOOK</code>: This is a more complicated environmental variable consisting of:</p><ul><li>A Git repository</li><li>Followed by two colons</li><li>Then a set of playbook names (without the .yml extension) which should be separated by commas.</li><li>If there are any more Git repositories, a semi colon should be inserted followed by another Git repository etc.</li></ul></blockquote><p>The end result is a command line which looks something like the following:</p><pre><code>ANSIBLE_PULL_REPOSITORY_PLAYBOOK=&#39;git@github.com:forbesmyester/provisioning-common.git::terminal_developer,gui_developer;git@github.com:someother/repository::another_playbook&#39; ROLES=developer vagrant up</code></pre><p>And if your playbooks are correct, a completely provisioned and working Vagrant virtual machine.</p><p>You can get the <a href="https://github.com/forbesmyester/init-provisioning">Project at GitHub</a>.</p><style>     pre {         margin: 1em;         background-color: #DDD;         padding: 0.5em;         border: 1px #AAA solid;     }          pre code {       padding: 0 0;     }          code {       background-color: #DDD;       padding: 0 0.3em;     }  </style>
